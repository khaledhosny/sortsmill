# -*- coding: utf-8 -*-

m4_defun([check_linalg],
[
AT_SETUP([$1])
AT_KEYWORDS([linalg auxiliary unit])
AT_CHECK_UNQUOTED(["${abs_builddir}"/$1],[$2],[$3],[$4])
AT_CLEANUP
])

#--------------------------------------------------------------------------

check_linalg([test_mpq_matrix_set_all 1 1 100/200],[0],[ 1/2 |],[])
check_linalg([test_mpq_matrix_set_all 2 3 -14/4],[0],[ -7/2 -7/2 -7/2 | -7/2 -7/2 -7/2 |],[])

#--------------------------------------------------------------------------

check_linalg([test_mpq_matrix_set_zero 1 1],[0],[ 0 |],[])
check_linalg([test_mpq_matrix_set_zero 2 3],[0],[ 0 0 0 | 0 0 0 |],[])

#--------------------------------------------------------------------------

check_linalg([test_mpq_matrix_transpose_memcpy 1 1 123/246],[0],[ 1/2 |],[])
check_linalg([test_mpq_matrix_transpose_memcpy 3 2 1 2 3 4 5 6],[0],[ 1 3 5 | 2 4 6 |],[])
check_linalg([test_mpq_matrix_transpose_memcpy 2 3 1 2 3 4 5 6],[0],[ 1 4 | 2 5 | 3 6 |],[])

#--------------------------------------------------------------------------

# Special case: scale by 0.
check_linalg([test_mpq_matrix_scale 1 1 0 123/246],[0],[ 0 |],[])
check_linalg([test_mpq_matrix_scale 3 2 0 1 2 3 4 5 6],[0],[ 0 0 | 0 0 | 0 0 |],[])
check_linalg([test_mpq_matrix_scale 2 3 0 1 2 3 4 5 6],[0],[ 0 0 0 | 0 0 0 |],[])

# Special case: scale by 1.
check_linalg([test_mpq_matrix_scale 1 1 1 123/246],[0],[ 1/2 |],[])
check_linalg([test_mpq_matrix_scale 3 2 1 1 2 3 4 5 6],[0],[ 1 2 | 3 4 | 5 6 |],[])
check_linalg([test_mpq_matrix_scale 2 3 1 1 2 3 4 5 6],[0],[ 1 2 3 | 4 5 6 |],[])

# Other cases.
check_linalg([test_mpq_matrix_scale 1 1 -1 123/246],[0],[ -1/2 |],[])
check_linalg([test_mpq_matrix_scale 3 2 2 1 2 3 4 5 6],[0],[ 2 4 | 6 8 | 10 12 |],[])
check_linalg([test_mpq_matrix_scale 2 3 -3 1 2 3 4 5 6],[0],[ -3 -6 -9 | -12 -15 -18 |],[])

#--------------------------------------------------------------------------

# alpha = beta = 0.
check_linalg([test_mpq_matrix_gemm 0 0 2 1 2 0 0 1 2 3 4 5 6 100 200],[0],[ 0 | 0 |],[])

# alpha = 0, beta = 1.
check_linalg([test_mpq_matrix_gemm 0 0 2 1 2 0 1 1 2 3 4 5 6 100 200],[0],[ 100 | 200 |],[])

# alpha = 0, beta = -1/2.
check_linalg([test_mpq_matrix_gemm 0 0 2 1 2 0 -1/2 1 2 3 4 5 6 100 200],[0],[ -50 | -100 |],[])

# alpha = 1, beta = 0.
check_linalg([test_mpq_matrix_gemm 0 0 2 2 3 1 0 1 2 3 4 5 6 7 8 9 10 11 12 100 200 300 400],[0],[ 58 64 | 139 154 |],[])
check_linalg([test_mpq_matrix_gemm 1 0 2 2 3 1 0 1 4 2 5 3 6 7 8 9 10 11 12 100 200 300 400],[0],[ 58 64 | 139 154 |],[])
check_linalg([test_mpq_matrix_gemm 0 1 2 2 3 1 0 1 2 3 4 5 6 7 9 11 8 10 12 100 200 300 400],[0],[ 58 64 | 139 154 |],[])
check_linalg([test_mpq_matrix_gemm 1 1 2 2 3 1 0 1 4 2 5 3 6 7 9 11 8 10 12 100 200 300 400],[0],[ 58 64 | 139 154 |],[])

# alpha = 1, beta = 1.
check_linalg([test_mpq_matrix_gemm 0 0 2 2 3 1 1 1 2 3 4 5 6 7 8 9 10 11 12 100 200 300 400],[0],[ 158 264 | 439 554 |],[])
check_linalg([test_mpq_matrix_gemm 1 0 2 2 3 1 1 1 4 2 5 3 6 7 8 9 10 11 12 100 200 300 400],[0],[ 158 264 | 439 554 |],[])
check_linalg([test_mpq_matrix_gemm 0 1 2 2 3 1 1 1 2 3 4 5 6 7 9 11 8 10 12 100 200 300 400],[0],[ 158 264 | 439 554 |],[])
check_linalg([test_mpq_matrix_gemm 1 1 2 2 3 1 1 1 4 2 5 3 6 7 9 11 8 10 12 100 200 300 400],[0],[ 158 264 | 439 554 |],[])

# alpha = 1, beta = -1/2.
check_linalg([test_mpq_matrix_gemm 0 0 2 2 3 1 -1/2 1 2 3 4 5 6 7 8 9 10 11 12 100 200 300 400],[0],[ 8 -36 | -11 -46 |],[])
check_linalg([test_mpq_matrix_gemm 1 0 2 2 3 1 -1/2 1 4 2 5 3 6 7 8 9 10 11 12 100 200 300 400],[0],[ 8 -36 | -11 -46 |],[])
check_linalg([test_mpq_matrix_gemm 0 1 2 2 3 1 -1/2 1 2 3 4 5 6 7 9 11 8 10 12 100 200 300 400],[0],[ 8 -36 | -11 -46 |],[])
check_linalg([test_mpq_matrix_gemm 1 1 2 2 3 1 -1/2 1 4 2 5 3 6 7 9 11 8 10 12 100 200 300 400],[0],[ 8 -36 | -11 -46 |],[])

# alpha = 5, beta = 0.
check_linalg([test_mpq_matrix_gemm 0 0 2 2 3 5 0 1 2 3 4 5 6 7 8 9 10 11 12 100 200 300 400],[0],[ 290 320 | 695 770 |],[])
check_linalg([test_mpq_matrix_gemm 1 0 2 2 3 5 0 1 4 2 5 3 6 7 8 9 10 11 12 100 200 300 400],[0],[ 290 320 | 695 770 |],[])
check_linalg([test_mpq_matrix_gemm 0 1 2 2 3 5 0 1 2 3 4 5 6 7 9 11 8 10 12 100 200 300 400],[0],[ 290 320 | 695 770 |],[])
check_linalg([test_mpq_matrix_gemm 1 1 2 2 3 5 0 1 4 2 5 3 6 7 9 11 8 10 12 100 200 300 400],[0],[ 290 320 | 695 770 |],[])

# alpha = 5, beta = 1.
check_linalg([test_mpq_matrix_gemm 0 0 2 2 3 5 1 1 2 3 4 5 6 7 8 9 10 11 12 100 200 300 400],[0],[ 390 520 | 995 1170 |],[])
check_linalg([test_mpq_matrix_gemm 1 0 2 2 3 5 1 1 4 2 5 3 6 7 8 9 10 11 12 100 200 300 400],[0],[ 390 520 | 995 1170 |],[])
check_linalg([test_mpq_matrix_gemm 0 1 2 2 3 5 1 1 2 3 4 5 6 7 9 11 8 10 12 100 200 300 400],[0],[ 390 520 | 995 1170 |],[])
check_linalg([test_mpq_matrix_gemm 1 1 2 2 3 5 1 1 4 2 5 3 6 7 9 11 8 10 12 100 200 300 400],[0],[ 390 520 | 995 1170 |],[])

# alpha = 5, beta = -1/2.
check_linalg([test_mpq_matrix_gemm 0 0 2 2 3 5 -1/2 1 2 3 4 5 6 7 8 9 10 11 12 100 200 300 400],[0],[ 240 220 | 545 570 |],[])
check_linalg([test_mpq_matrix_gemm 1 0 2 2 3 5 -1/2 1 4 2 5 3 6 7 8 9 10 11 12 100 200 300 400],[0],[ 240 220 | 545 570 |],[])
check_linalg([test_mpq_matrix_gemm 0 1 2 2 3 5 -1/2 1 2 3 4 5 6 7 9 11 8 10 12 100 200 300 400],[0],[ 240 220 | 545 570 |],[])
check_linalg([test_mpq_matrix_gemm 1 1 2 2 3 5 -1/2 1 4 2 5 3 6 7 9 11 8 10 12 100 200 300 400],[0],[ 240 220 | 545 570 |],[])

#--------------------------------------------------------------------------
