# -*- coding: utf-8 -*-

m4_defun([check_xunistr_h],
[
AT_SETUP([$1])
AT_KEYWORDS([auxiliary xunistr.c xunistr.h xunistring.h unit])
AT_SKIP_IF([test x"${utf8_locale}" = x])
AT_CHECK_UNQUOTED([LC_ALL="${utf8_locale}" LANGUAGE="${utf8_locale}" "${abs_builddir}"/$1],[$2],[$3],[$4])
AT_CLEANUP
])

check_xunistr_h([test_xunistr_h 'Eĥoŝanĝo ĉiuĵaŭde' 0],[0],
[Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
(NULL)
(NULL)
(NULL)






],[])

check_xunistr_h([test_xunistr_h 'Eĥoŝanĝo ĉiuĵaŭde' 1],[0],
[Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
(NULL)
(NULL)
(NULL)
E
E
E
E
E
E
],[])

check_xunistr_h([test_xunistr_h 'Eĥoŝanĝo ĉiuĵaŭde' 16],[0],
[Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
(NULL)
(NULL)
(NULL)
Eĥoŝanĝo ĉiuĵaŭd
Eĥoŝanĝo ĉiuĵaŭd
Eĥoŝanĝo ĉiuĵaŭd
Eĥoŝanĝo ĉiuĵaŭd
Eĥoŝanĝo ĉiuĵaŭd
Eĥoŝanĝo ĉiuĵaŭd
],[])

m4_foreach_w([n],[17 18 29],
[
check_xunistr_h([test_xunistr_h 'Eĥoŝanĝo ĉiuĵaŭde' n],[0],
[Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
(NULL)
(NULL)
(NULL)
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
Eĥoŝanĝo ĉiuĵaŭde
],[])
])

check_xunistr_h([test_xunistr_strtol_NULL "${abs_srcdir}"/test_xunistr_strtol.txt],
                [0],[ignore],[])

check_xunistr_h([test_xunistr_strtol_nonNULL "${abs_srcdir}"/test_xunistr_strtol.txt],
                [0],[ignore],[])

check_xunistr_h([test_xunistr_strtoul_NULL "${abs_srcdir}"/test_xunistr_strtol.txt],
                [0],[ignore],[])

check_xunistr_h([test_xunistr_strtoul_nonNULL "${abs_srcdir}"/test_xunistr_strtol.txt],
                [0],[ignore],[])

check_xunistr_h([test_xunistr_strtod_NULL "${abs_srcdir}"/test_xunistr_strtod.txt],
                [0],[ignore],[])

check_xunistr_h([test_xunistr_strtod_nonNULL "${abs_srcdir}"/test_xunistr_strtod.txt],
                [0],[ignore],[])

# A valid UTF-8 string.
check_xunistr_h([test_xunistr_valid_prefix "Eĥoŝanĝo ĉiuĵaŭde" 255 8],
                [0],[Eĥoŝanĝo ĉiuĵaŭde|Eĥoŝanĝo ĉiuĵaŭde|Eĥoŝanĝo ĉiuĵaŭde|],[])

# An invalid \xFF 'character'.
check_xunistr_h([test_xunistr_valid_prefix "Eĥoŝanĝo ĉiuĵ#aŭde" 255 8],
                [0],[Eĥoŝanĝo ĉiuĵ|Eĥoŝanĝo ĉiuĵ|Eĥoŝanĝo ĉiuĵ|],[])

# A ĵ character truncated after the first of its two bytes.
check_xunistr_h([test_xunistr_valid_prefix "Eĥoŝanĝo ĉiu##aŭde" 196 0 8],
                [0],[Eĥoŝanĝo ĉiu|Eĥoŝanĝo ĉiu|Eĥoŝanĝo ĉiu|],[])

# A valid UTF-16 string.
check_xunistr_h([test_xunistr_valid_prefix "#E#-#o##" 0 0 0 0 0 16],
                [0],[E-o|E-o|E-o|],[])

# A \xDC00 appearing illegally in a UTF-16 string.
# (It should appear only as a trailing surrogate.)
check_xunistr_h([test_xunistr_valid_prefix "#E#-####" 0 0 220 0 0 0 16],
                [0],[E-|E-|E-|],[])

# Truncation after a UTF-16 \xD800 lead surrogate.
check_xunistr_h([test_xunistr_valid_prefix "#E#-####" 0 0 216 0 0 0 16],
                [0],[E-|E-|E-|],[])

# A valid UTF-32 string.
check_xunistr_h([test_xunistr_valid_prefix "###E###-###o####" 0 0 0 0 0 0 0 0 0 0 0 0 0 32],
                [0],[E-o|E-o|E-o|],[])

# A UCS-4 string that is invalid as UTF-32, due to a \x110000
# character.
check_xunistr_h([test_xunistr_valid_prefix "###E###-########" 0 0 0 0 0 0 0 17 0 0 0 0 0 0 32],
                [0],[E-|E-|E-|],[])

# A valid UTF-8 string.
check_xunistr_h([test_xunistr_get_next "Eĥoŝanĝo ĉiuĵaŭde" 8],[0],[Eĥoŝanĝo ĉiuĵaŭde|0],[])

# An invalid UTF-8 string (\xFF 'character').
check_xunistr_h([test_xunistr_get_next "Eĥoŝanĝo ĉiuĵ#aŭde" 255 8],[0],[Eĥoŝanĝo ĉiuĵ|-1],[])

# Another invalid UTF-8 string (truncated ĵ character).
check_xunistr_h([test_xunistr_get_next "Eĥoŝanĝo ĉiu##aŭde" 196 0 8],[0],[Eĥoŝanĝo ĉiu|-1],[])

# A valid UTF-16 string.
check_xunistr_h([test_xunistr_get_next "#E#-#o##" 0 0 0 0 0 16],[0],[E-o|0],[])

# A valid UTF-32 string.
check_xunistr_h([test_xunistr_get_next "###E###-###o####" 0 0 0 0 0 0 0 0 0 0 0 0 0 32],[0],[E-o|0],[])
