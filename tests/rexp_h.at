m4_defun([check_rexp_h],
[
AT_SETUP([$1])
AT_KEYWORDS([auxiliary rexp.h unit rexp regex re regexp])
AT_CHECK_UNQUOTED(["${abs_builddir}"/$1],[$2],[$3],[$4])
AT_CLEANUP
])

//-------------------------------------------------------------------------

m4_foreach_w([filter],[identity study jit compile_study compile_jit redo_study redo_jit],
[

# Do not test stderr for JIT cases, because we do not know whether the
# JIT is supported and succeeded.
m4_defun([stderr_text],[m4_defun([no_study_text],
[study: no
jit:   no
])m4_defun([study_text],
[study: yes
jit:   no
])m4_case([$1],
          [identity],[no_study_text],
          [study],[study_text],
          [compile_study],[study_text],
          [redo_study],[study_text],
          [ignore])])

check_rexp_h([test_rexp_h haystack Xneedle match filter],[20],[ignore],[ignore])
check_rexp_h([test_rexp_h haystack Xhay match filter],[20],[ignore],[ignore])
check_rexp_h([test_rexp_h 'hay(stack)?' Xhay match filter],[20],[ignore],[ignore])
check_rexp_h([test_rexp_h hay Xhaystack match filter],[20],[ignore],[ignore])
check_rexp_h([test_rexp_h '((hay)(stack){2})' Xhaystackstack match filter],[20],[ignore],[ignore])

check_rexp_h([test_rexp_h haystack Xneedle search filter],[20],[ignore],[ignore])
check_rexp_h([test_rexp_h haystack Xhay search filter],[20],[ignore],[ignore])

check_rexp_h([test_rexp_h 'hay(stack)?' Xhay search filter],[0],
[0: 1 4 |hay|
1: -1 -1 |(NULL)|
2: -1 -1 |(NULL)|
],[stderr_text(filter)])

check_rexp_h([test_rexp_h hay Xhaystack search filter],[0],
[0: 1 4 |hay|
1: -1 -1 |(NULL)|
],[stderr_text(filter)])

check_rexp_h([test_rexp_h '((hay)(stack){2})' Xhaystackstack search filter],[0],
[0: 1 14 |haystackstack|
1: 1 14 |haystackstack|
2: 1 4 |hay|
3: 9 14 |stack|
4: -1 -1 |(NULL)|
],[stderr_text(filter)])

])

//-------------------------------------------------------------------------
