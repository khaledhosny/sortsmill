m4_defun([check_rexp_h],
[
AT_SETUP([$1])
AT_KEYWORDS([auxiliary rexp.h unit rexp regex re regexp])
AT_CHECK_UNQUOTED(["${abs_builddir}"/$1],[$2],[$3],[$4])
AT_CLEANUP
])

//-------------------------------------------------------------------------

check_rexp_h([test_rexp_h haystack needle match identity],[20],[ignore],[])
check_rexp_h([test_rexp_h haystack hay match identity],[20],[ignore],[])

check_rexp_h([test_rexp_h 'hay(stack)?' hay match identity],[0],
[0: 0 3 |hay|
1: -1 -1 |(NULL)|
2: -1 -1 |(NULL)|
],[])

check_rexp_h([test_rexp_h hay haystack match identity],[0],
[0: 0 3 |hay|
1: -1 -1 |(NULL)|
],[])

check_rexp_h([test_rexp_h '((hay)(stack){2})' haystackstack match identity],[0],
[0: 0 13 |haystackstack|
1: 0 13 |haystackstack|
2: 0 3 |hay|
3: 8 13 |stack|
4: -1 -1 |(NULL)|
],[])

check_rexp_h([test_rexp_h haystack needle search identity],[20],[ignore],[])
check_rexp_h([test_rexp_h haystack hay search identity],[20],[ignore],[])

check_rexp_h([test_rexp_h 'hay(stack)?' hay search identity],[0],
[0: 0 3 |hay|
1: -1 -1 |(NULL)|
2: -1 -1 |(NULL)|
],[])

check_rexp_h([test_rexp_h hay haystack search identity],[0],
[0: 0 3 |hay|
1: -1 -1 |(NULL)|
],[])

check_rexp_h([test_rexp_h '((hay)(stack){2})' haystackstack search identity],[0],
[0: 0 13 |haystackstack|
1: 0 13 |haystackstack|
2: 0 3 |hay|
3: 8 13 |stack|
4: -1 -1 |(NULL)|
],[])

//-------------------------------------------------------------------------

m4_foreach_w([filter],[identity study jit compile_study compile_jit],
[

check_rexp_h([test_rexp_h haystack Xneedle match filter],[20],[ignore],[ignore])
check_rexp_h([test_rexp_h haystack Xhay match filter],[20],[ignore],[ignore])
check_rexp_h([test_rexp_h 'hay(stack)?' Xhay match filter],[20],[ignore],[ignore])
check_rexp_h([test_rexp_h hay Xhaystack match filter],[20],[ignore],[ignore])
check_rexp_h([test_rexp_h '((hay)(stack){2})' Xhaystackstack match filter],[20],[ignore],[ignore])

check_rexp_h([test_rexp_h haystack Xneedle search filter],[20],[ignore],[ignore])
check_rexp_h([test_rexp_h haystack Xhay search filter],[20],[ignore],[ignore])

check_rexp_h([test_rexp_h 'hay(stack)?' Xhay search filter],[0],
[0: 1 4 |hay|
1: -1 -1 |(NULL)|
2: -1 -1 |(NULL)|
],[ignore])

check_rexp_h([test_rexp_h hay Xhaystack search filter],[0],
[0: 1 4 |hay|
1: -1 -1 |(NULL)|
],[ignore])

check_rexp_h([test_rexp_h '((hay)(stack){2})' Xhaystackstack search filter],[0],
[0: 1 14 |haystackstack|
1: 1 14 |haystackstack|
2: 1 4 |hay|
3: 9 14 |stack|
4: -1 -1 |(NULL)|
],[ignore])

])

//-------------------------------------------------------------------------
